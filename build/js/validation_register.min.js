var exists_flag = 0;
function getXmlHttp() {
    var xmlhttp;
    try {
        xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
    } catch (e) {
        try {
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        } catch (E) {
            xmlhttp = false;
        }
    }
    if (!xmlhttp && typeof XMLHttpRequest != 'undefined') {
        xmlhttp = new XMLHttpRequest();
    }
    return xmlhttp;
};
$(function validation_for_register() {
    var ck_username = /^[A-Za-z0-9_]{3,20}$/;
    var ck_email = /^([a-z0-9_\.-]+)@([a-z0-9_\.-]+)\.([a-z\.]{2,6})$/;
    var ck_password = /^[A-Za-z0-9_-]{6,18}$/;
    var ck_fio = /^[А-ЯЁ][а-яё]+(-[А-ЯЁ][а-яё]+)? [А-ЯЁ][а-яё]+( [А-ЯЁ][а-яё]+)?$/;
    $('#usernamesignup').on('blur', function() {
        var isValid = $("#usernamesignup").intlTelInput("isValidNumber");
        var num_to_reg = $("#usernamesignup").intlTelInput("getNumber");
        if (!isValid) {
            $('#logo_complete_username_signup').addClass('hidden');
            $('#logo_error_username_signup').removeClass('hidden');
            $('#error_username_signup').removeClass('hidden');
            $('#error_username_signup').removeClass('animated flipOutX');
            $('#error_username_signup').addClass('animated flipInX');
            $('#logo_error_username_signup').removeClass('animated flipOutX');
            $('#logo_error_username_signup').addClass('animated flipInX');
            $('#logo_complete_username_signup').removeClass('animated flipInX');
            //document.getElementById('register_button').style.visibility = "hidden";
            document.getElementById('tel_confsignup').disabled = true;
            document.getElementById('conf_button').disabled = true;
            $('#error_username_signup').text("Введите корректный мобильный телефон");
        } else {
            var xmlhttp_username_exist = getXmlHttp(); // Создаём объект XMLHTTP
            xmlhttp_username_exist.open('POST', 'already_exists.php', true); // Открываем асинхронное соединение
            xmlhttp_username_exist.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); // Отправляем кодировку
            xmlhttp_username_exist.send("username=" + encodeURIComponent(num_to_reg)); // Отправляем POST-запрос
            xmlhttp_username_exist.onreadystatechange = function() {
                if (xmlhttp_username_exist.readyState == 4 && xmlhttp_username_exist.status == 200) {
                    if (xmlhttp_username_exist.responseText == num_to_reg) {
                        $('#logo_complete_username_signup').addClass('hidden');
                        $('#logo_error_username_signup').removeClass('hidden');
                        $('#error_username_signup').removeClass('hidden');
                        $('#error_username_signup').removeClass('animated flipOutX');
                        $('#error_username_signup').addClass('animated flipInX');
                        $('#logo_error_username_signup').removeClass('animated flipOutX');
                        $('#logo_error_username_signup').addClass('animated flipInX');
                        $('#logo_complete_username_signup').removeClass('animated flipInX');
                        //document.getElementById('register_button').style.visibility = "hidden";
                        document.getElementById('tel_confsignup').disabled = true;
                        document.getElementById('conf_button').disabled = true;
                        $('#error_username_signup').text("Такой пользователь уже зарегистрирован!");
                        exists_flag = 1;
                    } else {
                        $('#error_username_signup').addClass('animated flipOutX');
                        $('#logo_error_username_signup').addClass('animated flipOutX');
                        $('#logo_complete_username_signup').addClass('animated flipInX');
                        $('#logo_error_username_signup').addClass('hidden');
                        $('#logo_complete_username_signup').removeClass('hidden');
                        exists_flag = 0;
                    }
                }
            }
        }
    });
    $('#fiosignup').on('blur', function() {
        var fiosignup = $(this).val();
        if (!ck_fio.test(fiosignup)) {
            $('#logo_complete_fio_signup').addClass('hidden');
            $('#logo_error_fio_signup').removeClass('hidden');
            $('#error_fio_signup').removeClass('hidden');
            $('#error_fio_signup').removeClass('animated flipOutX');
            $('#error_fio_signup').addClass('animated flipInX');
            $('#logo_error_fio_signup').removeClass('animated flipOutX');
            $('#logo_error_fio_signup').addClass('animated flipInX');
            $('#logo_complete_fio_signup').removeClass('animated flipInX');
            //document.getElementById('register_button').style.visibility = "hidden";
            $('#error_fio_signup').text("Введите корректное ФИО (русскими буквами)");
        } else {
            $('#error_fio_signup').addClass('animated flipOutX');
            $('#logo_error_fio_signup').addClass('animated flipOutX');
            $('#logo_complete_fio_signup').addClass('animated flipInX');
            $('#logo_error_fio_signup').addClass('hidden');
            $('#error_fio_signup').addClass('hidden');
            $('#logo_complete_fio_signup').removeClass('hidden');
        }
    })
    $('#emailsignup').on('blur', function() {
        var emailsignup = $(this).val();
        if (!ck_email.test(emailsignup)) {
            $('#logo_complete_email_signup').addClass('hidden');
            $('#logo_error_email_signup').removeClass('hidden');
            $('#error_email_signup').removeClass('hidden');
            $('#error_email_signup').removeClass('animated flipOutX');
            $('#error_email_signup').addClass('animated flipInX');
            $('#logo_error_email_signup').removeClass('animated flipOutX');
            $('#logo_error_email_signup').addClass('animated flipInX');
            $('#logo_complete_email_signup').removeClass('animated flipInX');
            //document.getElementById('register_button').style.visibility = "hidden";
            $('#error_email_signup').text("Введите корректный e-mail");
        } else {
            $('#logo_error_email_signup').addClass('hidden');
            $('#error_email_signup').addClass('hidden');
            $('#logo_complete_email_signup').removeClass('hidden');
            $('#error_email_signup').addClass('animated flipOutX');
            $('#logo_error_email_signup').addClass('animated flipOutX');
            $('#logo_complete_email_signup').addClass('animated flipInX');
        }
    })
    $('#passwordsignup').on('blur', function() {
        var passwordsignup = $(this).val();
        if (!ck_password.test(passwordsignup)) {
            $('#logo_complete_password_signup').addClass('hidden');
            $('#logo_error_password_signup').removeClass('hidden');
            $('#error_password_signup').removeClass('hidden');
            $('#error_password_signup').removeClass('animated flipOutX');
            $('#error_password_signup').addClass('animated flipInX');
            $('#logo_error_password_signup').removeClass('animated flipOutX');
            $('#logo_error_password_signup').addClass('animated flipInX');
            $('#logo_complete_password_signup').removeClass('animated flipInX');
            //document.getElementById('register_button').style.visibility = "hidden";
            $('#error_password_signup').text("Введите пароль длиной более 6 символов");
        } else {
            if ((document.getElementById('passwordsignup').value) !== (document.getElementById('passwordsignup_confirm').value) && (document.getElementById('passwordsignup_confirm').value) !== '') {
                $('#logo_complete_password_confirm_signup').addClass('hidden');
                $('#error_complete_password_signup').text("Пароли не совпадают");
                $('#error_complete_password_signup').removeClass('hidden');
                $('#logo_error_password_confirm_signup').removeClass('hidden');
                $('#error_complete_password_signup').removeClass('animated flipOutX');
                $('#error_complete_password_signup').addClass('animated flipInX');
                $('#logo_error_password_confirm_signup').removeClass('animated flipOutX');
                $('#logo_error_password_confirm_signup').addClass('animated flipInX');
                $('#logo_complete_password_confirm_signup').removeClass('animated flipInX');
            }
            if ((document.getElementById('passwordsignup_confirm').value) === (document.getElementById('passwordsignup').value) && (document.getElementById('passwordsignup_confirm').value) !== '') {
                $('#error_complete_password_signup').addClass('hidden');
                $('#logo_error_password_confirm_signup').addClass('hidden');
                $('#logo_complete_password_confirm_signup').removeClass('hidden');
                $('#error_complete_password_signup').addClass('animated flipOutX');
                $('#logo_error_password_confirm_signup').addClass('animated flipOutX');
                $('#logo_complete_password_confirm_signup').addClass('animated flipInX');
            }
            $('#logo_error_password_signup').addClass('hidden');
            $('#error_password_signup').addClass('hidden');
            $('#logo_complete_password_signup').removeClass('hidden');
            $('#error_password_signup').addClass('animated flipOutX');
            $('#logo_error_password_signup').addClass('animated flipOutX');
            $('#logo_complete_password_signup').addClass('animated flipInX');
        }
    })
    $('#passwordsignup_confirm').on('blur', function() {
        var passwordsignup_confirm = $(this).val();
        if (passwordsignup_confirm !== (document.getElementById('passwordsignup').value) || passwordsignup_confirm === '') {
            $('#logo_complete_password_confirm_signup').addClass('hidden');
            $('#logo_error_password_confirm_signup').removeClass('hidden');
            $('#error_complete_password_signup').removeClass('hidden');
            $('#error_complete_password_signup').removeClass('animated flipOutX');
            $('#error_complete_password_signup').addClass('animated flipInX');
            $('#logo_error_password_confirm_signup').removeClass('animated flipOutX');
            $('#logo_error_password_confirm_signup').addClass('animated flipInX');
            $('#logo_complete_password_confirm_signup').removeClass('animated flipInX');
            $('#error_complete_password_signup').text("Пароли не совпадают");
        } else {
            $('#logo_error_password_confirm_signup').addClass('hidden');
            $('#error_complete_password_signup').addClass('hidden');
            $('#logo_complete_password_confirm_signup').removeClass('hidden');
            $('#error_complete_password_signup').addClass('animated flipOutX');
            $('#logo_error_password_confirm_signup').addClass('animated flipOutX');
            $('#logo_complete_password_confirm_signup').addClass('animated flipInX');
        }
    });
    $("#tel_confsignup").on('input', function() {
            if (document.getElementById('tel_confsignup').disabled == true) {
                return false;
            }

            function e(e) {
                var i = getXmlHttp();
                i.open("POST", "telephone_save_confirmation.php", !0), i.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"), i.send("telephone=" + encodeURIComponent(e)), i.onreadystatechange = function() {
                    if (4 == i.readyState && 200 == i.status) {
                        var e = i.responseText;
                        document.getElementById("tel_confsignup").value == e && "" !== document.getElementById("tel_confsignup").value ? (($('#loader-wrapper').removeClass('hidden')), $("#error_tel_conf_signup").addClass("animated flipOutX"), $("#logo_error_tel_conf_signup").addClass("animated flipOutX"), $("#logo_complete_tel_conf_signup").addClass("animated flipInX"), $("#logo_error_tel_conf_signup").addClass('hidden'), $("#error_tel_conf_signup").addClass('hidden'), $("#logo_complete_tel_conf_signup").removeClass('hidden'), register()) : ($("#error_tel_conf_signup").removeClass("animated flipOutX"), $("#error_tel_conf_signup").addClass("animated flipInX"), $("#logo_error_tel_conf_signup").removeClass("animated flipOutX"), $("#logo_error_tel_conf_signup").addClass("animated flipInX"), $("#logo_complete_tel_conf_signup").removeClass("animated flipInX"), $("#error_tel_conf_signup").text("Введите правильный код"), $("#logo_complete_tel_conf_signup").addClass('hidden'), $("#logo_error_tel_conf_signup").removeClass('hidden'), $("#error_tel_conf_signup").removeClass('hidden'))
                    }
                }
            }
            var i = $("#usernamesignup").intlTelInput("getNumber");
            e(i)
        }),
        setInterval(function() {
            if (($("#usernamesignup").intlTelInput("isValidNumber")) && !(exists_flag) &&(ck_fio.test(document.getElementById("fiosignup").value)) && (ck_email.test(document.getElementById("emailsignup").value)) && (ck_password.test(document.getElementById("passwordsignup").value)) && ((document.getElementById("passwordsignup_confirm").value) == (document.getElementById("passwordsignup").value)) && ((document.getElementById("passwordsignup").value) == (document.getElementById("passwordsignup_confirm").value))) {
                document.getElementById('conf_button').disabled = false;
                $('#usernamesignup').prop('readonly', true);
                $('#fiosignup').prop('readonly', true);
                $('#emailsignup').prop('readonly', true);
                $('#passwordsignup').prop('readonly', true);
                $('#passwordsignup_confirm').prop('readonly', true);
            } else {
                document.getElementById('tel_confsignup').disabled = true;
                document.getElementById('conf_button').disabled = true;
            }
        }, 10);
});