// ФУНКЦИЯ - ЗАГЛУШКА ДЛЯ SUBMIT POST МЕТОДА //
$(function cancel_POST() {
  $('#login_button').submit(function() {
    return false;

  });
});
$(function cancel_POST() {
  $('#myForm').submit(function() {
    register();
    return false;
  })
});

 function getXmlHttp() {
    var xmlhttp;
    try {
      xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
    } catch (e) {
    try {
      xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    } catch (E) {
      xmlhttp = false;
    }
    }
    if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
      xmlhttp = new XMLHttpRequest();
    }
    return xmlhttp;
  };


function register (){

 var connection = new Strophe.Connection('http://jmessager.ru/http-bind/')
connection.register.connect("srv", callback, 60, 1);

var login = $("#usernamesignup").intlTelInput("getNumber");
var fio = (document.getElementById("fiosignup").value);
var pass = (document.getElementById("passwordsignup").value);
var email = (document.getElementById("emailsignup").value);

	function callback (status) {

    if (status === Strophe.Status.REGISTER) {
		connection.register.fields.username = login;
        connection.register.fields.password = pass;
		connection.register.fields.name = fio;
		connection.register.fields.email = email;
        connection.register.submit();






		 setTimeout (redirect_to_login, 1000);
		function redirect_to_login() {
			window.location.hash = '#tologin';
			$('#loader-wrapper').addClass('hidden');
		};

    }
		else if (status === Strophe.Status.REGISTERED) {
        console.log("registered!");
        connection.authenticate();

    } else if (status === Strophe.Status.CONFLICT) {
      setTimeout (show_already_exist, 3000);
		function show_already_exist() {
			$("#form").show().html("<h1>Пользователь с таким логином уже существует!</h1>")
		};

    } else if (status === Strophe.Status.NOTACCEPTABLE) {
        console.log("Registration form not properly filled out.")
    }
		else if (status === Strophe.Status.REGIFAIL) {
        console.log("The Server does not support In-Band Registration")
    } else if (status === Strophe.Status.CONNECTED) {
        // do something after successful authentication

			};
	};
};
